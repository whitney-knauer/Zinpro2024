---
title: "Health and Health Score Results"
author: "WAK"
date: "today"
format: 
  html:
    toc: true 
    toc-float: true
    toc-location: left
---

```{r}
#| include: false
#| warning: false
#| echo: false

library(epiDisplay)
library(knitr)
library(pROC)
library(tidyverse)
library(readxl)
library(ggplot2)
library(gmodels)
library(ggbeeswarm)
library(dplyr)
library(ggpubr)
library(psych)
library(lme4)
library(Matrix)
library(lmerTest)
library(irr)
library(lmerTest)
library(emmeans)
library(doBy)       
library(gmodels)    
library(car)           
library(cowplot)       
library(gridGraphics)  
library(multcomp)
library(hms)
library(gt)
```

```{r}
#| include: false
#| echo: false
#| warning: false

enroll <- read_csv('data/Zinpro 2024 enrollment final.csv')

clean <-
  enroll |> 
  filter(removeyn != 1)

#removes calf 113, who did not have correct information    

#changes these variables to "hours" vs. "seconds"
clean$DOFed2HrsOld <- as.numeric(clean$DOFed2HrsOld)/3600
clean$DOFed12IntervHrs <- as.numeric(clean$DOFed12IntervHrs)/3600
clean$DOFed1MinOld <- as.numeric(clean$DOFed1MinOld)/60
  
clean<- 
  clean |> 
  mutate(refuse=
           case_when(
             D0Fed2VolRefusemL > 0    ~ 1, 
             D0Fed2VolRefusemL == 0   ~ 0))

clean<- 
  clean |> 
  mutate(refuseM1=
           case_when(
             D1MilkRefusemL > 0    ~ 1, 
             D1MilkRefusemL == 0   ~ 0))


clean<- 
  clean |> 
  mutate(refuseMeasure = ifelse(D1MilkRefusemL >= 250, 1, 0)) 

clean<- 
  clean |> 
  mutate(Treated = 
           case_when(
             FarmDzYN == "Y"  ~ 1,
             FarmDzYN == "N"  ~ 0
           ))
         



health <- read_csv('data/CHSdata_2024_08_12_08_57.csv')
health<- health |> 
  filter(`Calf Age` != 4)

#Get rid of two calves who had d4 recorded instead of d3

#Create a better data set and craete variables for TRS, Fever, Scours, scour severity, and brd

health<-
health |> 
  mutate(
    age = `Calf Age`, 
    .after = CalfID
    )

health


Full<-
health |> 
  select(CalfID, age, BodyTemp, Appetite, Attitude, Nose, Eye, Ear, Cough, Temperature, Fecal, Navel, Joint) |> 
  mutate(
    TRS = Nose + Eye + Ear + Cough + Temperature,
    THS = Appetite + Attitude + Nose + Eye + Ear + Cough + Temperature + Fecal + Navel + Joint, 
    BRD = if_else(TRS>=4, 1, 0),
    Refuse = if_else(Appetite>=2, 1, 0),
    Scour = if_else(Fecal>=2, 1, 0),
    Fever = if_else(BodyTemp>=2, 1, 0), 
    Sick = if_else(THS>=4, 1, 0), 
    DiarSS = case_when(
      Fecal <= 1       ~ "Normal", 
      Fecal == 2       ~ "Mild",
      Fecal == 3       ~ "Severe"),
    #DiarSS = factor(DiarSS, levels = c("Normal", "Mild", "Severe"))
    )


Full

#merge Full and enroll

hs <- merge(Full, clean, by = "CalfID", all.x = TRUE)

#had to remove weird calves

hs <- hs |> 
  filter(!as.numeric(CalfID) %in% c(113, 191, 1133))


hsd1<- hs |> 
  filter(age == 1)
```

## Data Checks

We should have n=155 obs total (n=31 obs per day) for each treatment group but it appears we are missing some data. In addition, not every calf has a recorded observation for each of the health score categories. Not sure that matters too much, but something to note.

```{r}
#| echo: false
#| warning: false

hs |> 
  count(age)

hs |> 
  count(D0Fed2TxGrp)

hs |> 
  group_by(age, D0Fed2TxGrp) |> 
  count()



```

### Tables of All Health Outcomes by day and TRT Group

Age is days in age (same as Day post Colostrum Feeding)

```{r}
#| warning: false


CrossTable(hs$age,  hs$Appetite, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Attitude, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Nose, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Eye, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Ear, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Cough, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Temperature, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$TRS, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$THS, prop.r = FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$BRD, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Scour, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Fever, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$DiarSS, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Sick, prop.r=FALSE, prop.c = FALSE)
CrossTable(hs$age,  hs$Refuse, prop.r=FALSE, prop.c = FALSE)

hs |> 
  ggplot(mapping=aes(x=BodyTemp))+
  theme_classic()+
  geom_histogram(binwidth=0.2, 
                 fill="skyblue", 
                 color="black", 
                 alpha=0.7)+
  labs(title = "Histogram of Calf Body Temperature")




strat <- hs$age
BRD <- table(hs$D0Fed2TxGrp, hs$BRD, strat)
print(BRD)


Scour <- table(hs$D0Fed2TxGrp, hs$Scour, strat)
print(Scour)

#What BT = a fever??
Fever <- table(hs$D0Fed2TxGrp, hs$Fever, strat)
print(Fever)

Sick <- table(hs$D0Fed2TxGrp, hs$Sick, strat)
print(Sick)

Hungry <- table(hs$D0Fed2TxGrp, hs$Refuse, strat)
print(Hungry)
```

## Scours

### 3 day Model

```{r}
#| warning: false


#What proportion of calves scour in each group?

table(hs$D0Fed2TxGrp, hs$Scour)
#        0  1
#   CSB 77 11 = 11/88=12.5
#   CST 68 21 = 21/89=23.6
#   MCB 78 12 = 12/90=13.3
#   MCT 74 13 = 13/87=14.9
#   MRB 72 16 = 16/88=18.2

prop.table(table(hs$age, hs$Scour), margin = 1)  
prop.table(table(hs$CrossbredYN, hs$Scour), margin = 1)  
prop.table(table(hs$CalfSizeLgSm, hs$Scour), margin = 1)  
prop.table(table(hs$SexMF, hs$Scour), margin = 1)  


CrossTable(hs$Scour,  hs$age, fisher=TRUE) #yes include in model
CrossTable(hs$Scour,  hs$CrossbredYN, fisher=TRUE) #no not associated
CrossTable(hs$Scour,  hs$CalfSizeLgSm,  fisher=TRUE) #yes, less than 0.1
CrossTable(hs$Scour,  hs$SexMF, fisher=TRUE) #no
CrossTable(hs$Scour,  hs$D0Fed2TxGrp, fisher = TRUE) #no



# Fit a repeated measures mixed effects model for scours.
hs$D0Fed2TxGrp <- factor(hs$D0Fed2TxGrp) 
hs$D0Fed2TxGrp <- relevel(hs$D0Fed2TxGrp, ref = "MRB")
model <- glmer(Scour ~ D0Fed2TxGrp +  CalfSizeLgSm + (1 + age | CalfID), family = "binomial", data = hs)

summary(model)
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

fixed_effects <- fixef(model)
odds_ratios <- exp(fixed_effects)
cat("Odds Ratios:\n")
print(odds_ratios)

type3_p_values <- Anova(model, type="III", test="Chisq")
cat("\nType III p-values:\n")
print(type3_p_values)
adjusted_proportions <- odds_ratios / (1 + odds_ratios)
cat("\nAdjusted Proportions:\n")
print(adjusted_proportions)
contrasts <- glht(model, linfct = mcp(D0Fed2TxGrp = "Tukey"))
summary(contrasts)

```

### 1 day Model

```{r}

table(hsd1$D0Fed2TxGrp, hsd1$Scour)

#     0  1
#  MRB 24  7
#  CSB 25  4
#  CST 22  8
#  MCB 25  5
#  MCT 21  8


# Fit a logistic model for Scour on Day 1.
hsd1$D0Fed2TxGrp <- factor(hsd1$D0Fed2TxGrp) 
hsd1$D0Fed2TxGrp <- relevel(hsd1$D0Fed2TxGrp, ref = "MRB")
model <- glm(Scour ~ D0Fed2TxGrp + CalfSizeLgSm, family = "binomial", data = hsd1)

summary(model)
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

em <- emmeans(model, specs = "D0Fed2TxGrp", type = "response")
em_df <- as.data.frame(em)

em_df$odds <- em_df$prob / (1 - em_df$prob)
em_df$log_odds <- log(em_df$odds)
em_df$log_odds_lower <- log(em_df$asymp.LCL / (1 - em_df$asymp.LCL))
em_df$log_odds_upper <- log(em_df$asymp.UCL / (1 - em_df$asymp.UCL))

ref_log_odds <- em_df$log_odds[em_df$D0Fed2TxGrp == "MRB"]
em_df$OR <- exp(em_df$log_odds - ref_log_odds)
em_df$OR_lower <- exp(em_df$log_odds_lower - ref_log_odds)
em_df$OR_upper <- exp(em_df$log_odds_upper - ref_log_odds)
print(em_df[, c("D0Fed2TxGrp", "prob", "odds", "OR", "OR_lower", "OR_upper")])

```

## Sick Model

### 3 day Model

```{r}
#| warning: false


#What proportion of calves had a HS>=4 in each group?

table(hs$D0Fed2TxGrp, hs$Sick)
#        0  1
#   CSB 69 16 = 16/85=18.8
#   CST 56 29 = 29/85=34.1
#   MCB 63 23 = 23/86=26.7
#   MCT 59 25 = 25/84=29.7
#   MRB 54 32 = 32/86=37.2

prop.table(table(hs$age, hs$Sick), margin = 1)  
prop.table(table(hs$CrossbredYN, hs$Sick), margin = 1)  
prop.table(table(hs$CalfSizeLgSm, hs$Sick), margin = 1)  
prop.table(table(hs$SexMF, hs$Sick), margin = 1)  


CrossTable(hs$Sick,  hs$age, fisher=TRUE) #yes include in model
CrossTable(hs$Sick,  hs$CrossbredYN, fisher=TRUE) #no not associated
CrossTable(hs$Sick,  hs$CalfSizeLgSm,  fisher=TRUE) #no
CrossTable(hs$Sick,  hs$SexMF, fisher=TRUE) #yes
CrossTable(hs$Sick,  hs$D0Fed2TxGrp, fisher = TRUE) #0.07


#not sure about this one. Do I add age as interaction or not? 
# Fit a repeated measures mixed effects model for scours.
hs$D0Fed2TxGrp <- factor(hs$D0Fed2TxGrp) 
hs$D0Fed2TxGrp <- relevel(hs$D0Fed2TxGrp, ref = "MRB")
model <- glmer(Sick ~ D0Fed2TxGrp +  SexMF + (1 + age | CalfID), family = "binomial", data = hs)

summary(model)
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

fixed_effects <- fixef(model)
odds_ratios <- exp(fixed_effects)
cat("Odds Ratios:\n")
print(odds_ratios)

type3_p_values <- Anova(model, type="III", test="Chisq")
cat("\nType III p-values:\n")
print(type3_p_values)
adjusted_proportions <- odds_ratios / (1 + odds_ratios)
cat("\nAdjusted Proportions:\n")
print(adjusted_proportions)
contrasts <- glht(model, linfct = mcp(D0Fed2TxGrp = "Tukey"))
summary(contrasts)
```

### 1 Day Model

```{r}

table(hsd1$D0Fed2TxGrp, hsd1$Sick)

#       0  1
#  MRB 13 17 = 17/30 = 56.6
#  CSB 23  4 = 4/27  = 14.8
#  CST 19 10 = 10/29 = 34.4
#  MCB 16 13 = 13/29 = 44.8
#  MCT 17 10 = 10/27 = 37.0


# Fit a logistic model for Sick on Day 1.
hsd1$D0Fed2TxGrp <- factor(hsd1$D0Fed2TxGrp) 
hsd1$D0Fed2TxGrp <- relevel(hsd1$D0Fed2TxGrp, ref = "MRB")
model <- glm(Sick ~ D0Fed2TxGrp + SexMF, family = "binomial", data = hsd1)

summary(model)
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

em <- emmeans(model, specs = "D0Fed2TxGrp", type = "response")
em_df <- as.data.frame(em)

em_df$odds <- em_df$prob / (1 - em_df$prob)
em_df$log_odds <- log(em_df$odds)
em_df$log_odds_lower <- log(em_df$asymp.LCL / (1 - em_df$asymp.LCL))
em_df$log_odds_upper <- log(em_df$asymp.UCL / (1 - em_df$asymp.UCL))

ref_log_odds <- em_df$log_odds[em_df$D0Fed2TxGrp == "MRB"]
em_df$OR <- exp(em_df$log_odds - ref_log_odds)
em_df$OR_lower <- exp(em_df$log_odds_lower - ref_log_odds)
em_df$OR_upper <- exp(em_df$log_odds_upper - ref_log_odds)
print(em_df[, c("D0Fed2TxGrp", "prob", "odds", "OR", "OR_lower", "OR_upper")])

```

## Appetite 

### 3 Day Model

```{r}
#| warning: false



#What proportion of calves refused milk in each group?

table(hs$D0Fed2TxGrp, hs$Refuse)
#       0  1
#  CSB 83  3 = 3/86=3.4
#  CST 79  8 = 8/87=9.2
#  MCB 74 13 = 13/87=14.9
#  MCT 72 12 = 12/84=14.3
#  MRB 67 19 = 19/86=22.1

#What proportion of calves refused milk in each group by day?

prop.table(table(hs$age, hs$Refuse), margin = 1)  
prop.table(table(hs$CrossbredYN, hs$Refuse), margin = 1)  
prop.table(table(hs$CalfSizeLgSm, hs$Refuse), margin = 1)  
prop.table(table(hs$SexMF, hs$Refuse), margin = 1)  


CrossTable(hs$Refuse,  hs$age, fisher=TRUE) #yes include in model
CrossTable(hs$Refuse,  hs$CrossbredYN, fisher=TRUE) #no not associated
CrossTable(hs$Refuse,  hs$CalfSizeLgSm,  fisher=TRUE) #no
CrossTable(hs$Refuse,  hs$SexMF, fisher=TRUE) #no
CrossTable(hs$Refuse,  hs$D0Fed2TxGrp, fisher = TRUE) #yes



# Fit a repeated measures mixed effects model for refusals.
hs$D0Fed2TxGrp <- factor(hs$D0Fed2TxGrp) 
hs$D0Fed2TxGrp <- relevel(hs$D0Fed2TxGrp, ref = "MRB")
model <- glmer(Refuse ~ D0Fed2TxGrp * age + (1 | CalfID), family = "binomial", data = hs)

summary(model)
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

fixed_effects <- fixef(model)
odds_ratios <- exp(fixed_effects)
cat("Odds Ratios:\n")
print(odds_ratios)

type3_p_values <- Anova(model, type="III", test="Chisq")
cat("\nType III p-values:\n")
print(type3_p_values)
adjusted_proportions <- odds_ratios / (1 + odds_ratios)
cat("\nAdjusted Proportions:\n")
print(adjusted_proportions)
contrasts <- glht(model, linfct = mcp(D0Fed2TxGrp = "Tukey"))
summary(contrasts)
```

### 1 Day Model

```{r}
#| warning: false



#What proportion of calves refused milk at the first feeding according to appetite?

table(hsd1$D0Fed2TxGrp, hsd1$Refuse)
#       0  1
#  CSB 25  3 = 3/28=10.7
#  CST 22  7 = 7/29=24.1
#  MCB 16 13 = 13/29=44.8
#  MCT 17 10 = 10/27=37.0
#  MRB 15 15 = 15/30=50

#This is a calculated measure based on mL and a calf was considered a refusal if they refused 25% or more milk at first milk feeding
table(hsd1$D0Fed2TxGrp, hsd1$refuseMeasure)
#       0  1
#  CSB 24  6 = 6/30 = 20%
#  CST 20 10 = 10/30 = 33%
#  MCB 10 20 = 20/30 = 66%
#  MCT 16 13 = 13/29 = 45%
#  MRB 13 18 = 18/31 = 58%



prop.table(table(hsd1$age, hsd1$Refuse), margin = 1)  
prop.table(table(hsd1$CrossbredYN, hsd1$Refuse), margin = 1)  
prop.table(table(hsd1$CalfSizeLgSm, hsd1$Refuse), margin = 1)  
prop.table(table(hsd1$SexMF, hsd1$Refuse), margin = 1)  


CrossTable(hsd1$Refuse,  hsd1$CrossbredYN, fisher=TRUE) #no not associated
CrossTable(hsd1$Refuse,  hsd1$CalfSizeLgSm,  fisher=TRUE) #no
CrossTable(hsd1$Refuse,  hsd1$SexMF, fisher=TRUE) #yes
CrossTable(hsd1$Refuse,  hsd1$D0Fed2TxGrp, fisher = TRUE) #yes



# Fit a logistic model for refuse.
hsd1$D0Fed2TxGrp <- factor(hsd1$D0Fed2TxGrp) 
hsd1$D0Fed2TxGrp <- relevel(hsd1$D0Fed2TxGrp, ref = "MRB")
model <- glm(Refuse ~ D0Fed2TxGrp + SexMF, family = "binomial", data = hsd1)

summary(model)
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

em <- emmeans(model, specs = "D0Fed2TxGrp", type = "response")
em_df <- as.data.frame(em)

em_df$odds <- em_df$prob / (1 - em_df$prob)
em_df$log_odds <- log(em_df$odds)
em_df$log_odds_lower <- log(em_df$asymp.LCL / (1 - em_df$asymp.LCL))
em_df$log_odds_upper <- log(em_df$asymp.UCL / (1 - em_df$asymp.UCL))

ref_log_odds <- em_df$log_odds[em_df$D0Fed2TxGrp == "MRB"]
em_df$OR <- exp(em_df$log_odds - ref_log_odds)
em_df$OR_lower <- exp(em_df$log_odds_lower - ref_log_odds)
em_df$OR_upper <- exp(em_df$log_odds_upper - ref_log_odds)
print(em_df[, c("D0Fed2TxGrp", "prob", "odds", "OR", "OR_lower", "OR_upper")])

```

## Refusals - Milk 1 (calculated)

### 1 Day Model

```{r}

#This is a calculated measure based on mL and a calf was considered a refusal if they refused 25% or more milk at first milk feeding
table(hsd1$D0Fed2TxGrp, hsd1$refuseMeasure)
#       0  1
#  CSB 24  6 = 6/30 = 20%
#  CST 20 10 = 10/30 = 33%
#  MCB 10 20 = 20/30 = 66%
#  MCT 16 13 = 13/29 = 45%
#  MRB 13 18 = 18/31 = 58%


CrossTable(hsd1$refuseMeasure,  hsd1$CrossbredYN, fisher=TRUE) #no not associated
CrossTable(hsd1$refuseMeasure,  hsd1$CalfSizeLgSm,  fisher=TRUE) #no
CrossTable(hsd1$refuseMeasure,  hsd1$SexMF, fisher=TRUE) #no
CrossTable(hsd1$refuseMeasure,  hsd1$D0Fed2TxGrp, fisher = TRUE) #yes



# Fit a logistic model for refuse.
hsd1$D0Fed2TxGrp <- factor(hsd1$D0Fed2TxGrp) 
hsd1$D0Fed2TxGrp <- relevel(hsd1$D0Fed2TxGrp, ref = "MRB")
model <- glm(refuseMeasure ~ D0Fed2TxGrp + CalfSizeLgSm, family = "binomial", data = hsd1)

summary(model)
Anova(model, type = "III")
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

em <- emmeans(model, specs = "D0Fed2TxGrp", type = "response")
em_df <- as.data.frame(em)

em_df$odds <- em_df$prob / (1 - em_df$prob)
em_df$log_odds <- log(em_df$odds)
em_df$log_odds_lower <- log(em_df$asymp.LCL / (1 - em_df$asymp.LCL))
em_df$log_odds_upper <- log(em_df$asymp.UCL / (1 - em_df$asymp.UCL))

ref_log_odds <- em_df$log_odds[em_df$D0Fed2TxGrp == "MRB"]
em_df$OR <- exp(em_df$log_odds - ref_log_odds)
em_df$OR_lower <- exp(em_df$log_odds_lower - ref_log_odds)
em_df$OR_upper <- exp(em_df$log_odds_upper - ref_log_odds)
print(em_df[, c("D0Fed2TxGrp", "prob", "odds", "OR", "OR_lower", "OR_upper")])

contrasts <- glht(model, linfct = mcp(D0Fed2TxGrp = "Tukey"))
summary(contrasts)

```

## Farm Reported Disease (y/n)

```{r}
#| warning: false

table(clean$D0Fed2TxGrp, clean$FarmDzYN)

#       N  Y
#  CSB 19 12 = 12/31= 7.7
#  CST 19 12 = 12/31= 7.7
#  MCB 19 12 = 12/31= 7.7
#  MCT 23  8 = 8/31= 5.2
#  MRB 17 14 = 14/31= 9.0

table(clean$D0Fed2TxGrp, clean$Treated)



sick_<-
  clean |> 
  group_by(D0Fed2TxGrp, FarmDzYN) |> 
  summarize(count=n(), .groups="drop") |> 
  mutate(proportion = signif(count/sum(count), digits=2))
sick_


CrossTable(clean$FarmDzYN,  clean$CrossbredYN, fisher=TRUE) #no not associated
CrossTable(clean$FarmDzYN,  clean$CalfSizeLgSm,  fisher=TRUE) #yes
CrossTable(clean$FarmDzYN,  clean$SingleTwinST,  fisher=TRUE) #no
CrossTable(clean$FarmDzYN,  clean$SexMF, fisher=TRUE) #yes
CrossTable(clean$FarmDzYN,  clean$D0Fed2TxGrp, fisher = TRUE) #no


# Fit a logistic model for Farm Treatment.
clean$D0Fed2TxGrp <- factor(clean$D0Fed2TxGrp) 
clean$D0Fed2TxGrp <- relevel(clean$D0Fed2TxGrp, ref = "MRB")
model <- glm(Treated ~ D0Fed2TxGrp + CalfSizeLgSm + SexMF , family = "binomial", data = clean)

summary(model)
Anova(model, type = "III")
emmeans(model, specs = "D0Fed2TxGrp", at = list(D0Fed2TxGrp = c("CSB", "CST", "MCB", "MCT", "MRB")), type = "response")

em <- emmeans(model, specs = "D0Fed2TxGrp", type = "response")
em_df <- as.data.frame(em)

em_df$odds <- em_df$prob / (1 - em_df$prob)
em_df$log_odds <- log(em_df$odds)
em_df$log_odds_lower <- log(em_df$asymp.LCL / (1 - em_df$asymp.LCL))
em_df$log_odds_upper <- log(em_df$asymp.UCL / (1 - em_df$asymp.UCL))

ref_log_odds <- em_df$log_odds[em_df$D0Fed2TxGrp == "MRB"]
em_df$OR <- exp(em_df$log_odds - ref_log_odds)
em_df$OR_lower <- exp(em_df$log_odds_lower - ref_log_odds)
em_df$OR_upper <- exp(em_df$log_odds_upper - ref_log_odds)
print(em_df[, c("D0Fed2TxGrp", "prob", "odds", "OR", "OR_lower", "OR_upper")])

contrasts <- glht(model, linfct = mcp(D0Fed2TxGrp = "Tukey"))
summary(contrasts)

```
